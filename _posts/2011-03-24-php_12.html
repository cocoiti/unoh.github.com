---
layout: post
title: "PHPで利用出来るテストと開発に便利なツール"
---
<br />
<p>こんにちは。yukiです。</p><br />
<p>今日はテストや普段の開発に便利なツールのご紹介をしたいと思います。PHP限定のツールですので、ご了承下さい。</p><br />
<p>ZyngaJapanでは、昨日リニューアルオープンした「<a href="http://www.zynga.co.jp/service/farmvillage.html">ファームビレッジ</a>」でも、<a href="http://wiki.hudson-ci.org/display/JA/Meet+Hudson">Jenkins</a>(旧Hudson)によるCIを行って開発しており、TDDやJenkinsでのCIを利用する文化がだんだんと浸透してきています。Jenkinsのプラグインとして利用できるものも多くありますが、当然ながらコマンドラインからも利用出来ますので、コミット前に自分のコードをチェックすることもできます。</p><br />
<h3><a href="https://github.com/sebastianbergmann/phpcpd">phpcpd</a></h3><br />
<p>コードの中でコピー&amp;ペーストで記述されている部分を検出してくれます。<br />どの程度の重複から検出するかを柔軟に設定できるので、まず大きな部分から修正するなど判断ができ便利です。</p><br />
<pre class="code">$ phpcpd /path/to/project<br />
phpcpd @package_version@ by Sebastian Bergmann.<br />
<br />
Found 13 exact clones with 339 duplicated lines in 17 files:<br />
<br />
  - hoge/fuga/Foo.php:55-104<br />
    hoge/fuga/Bar.php:85-134<br />
<br />
0.50% duplicated lines out of 68425 total lines of code.<br />
<br />
Time: 10 seconds, Memory: 33.00Mb</pre><br />
<h3><a href="https://github.com/sebastianbergmann/phpdcd">phpdcd</a></h3><br />
<p>どこからもコールされていないメソッドなどを検出してくれます。リファクタリング対象として確認に役立ちます。</p><br />
<pre class="code">$ phpdcd /path/to/project<br />
phpdcd 0.9.2 by Sebastian Bergmann.<br />
<br />
  - Foo::execute()<br />
    declared in Foo.php:42<br />
<br />
  - Bar::getActionName()<br />
    declared in Bar.php:27<br />
<br />
  - Hoge::execute()<br />
    declared in Hoge.php:34</pre><br />
<h3><a href="https://github.com/sebastianbergmann/phploc">phploc</a></h3><br />
<p>以下のようにphpファイルの構成要素を算出してくれます。(数字は全てダミーです)</p><br />
<pre class="code">$ phploc /path/to/project<br />
phploc @package_version@ by Sebastian Bergmann.<br />
<br />
Directories:                                        999<br />
Files:                                             9999<br />
<br />
Lines of Code (LOC):                             999999<br />
  Cyclomatic Complexity / Lines of Code:           0.01<br />
Comment Lines of Code (CLOC):                     99999<br />
Non-Comment Lines of Code (NCLOC):               999999<br />
<br />
Namespaces:                                           9<br />
Interfaces:                                          99<br />
Classes:                                            999<br />
  Abstract:                                          99 (9.99%)<br />
  Concrete:                                         999 (99.99%)<br />
  Average Class Length (NCLOC):                     999<br />
Methods:                                           9999<br />
  Scope:<br />
    Non-Static:                                    9999 (99.99%)<br />
    Static:                                           9 (9.99%)<br />
  Visibility:<br />
    Public:                                        9999 (99.99%)<br />
    Non-Public:                                     999 (99.99%)<br />
  Average Method Length (NCLOC):                     99<br />
  Cyclomatic Complexity / Number of Methods:       9.99<br />
<br />
Anonymous Functions:                                 99<br />
Functions:                                            9<br />
<br />
Constants:                                          999<br />
  Global constants:                                   9<br />
  Class constants:                                  999</pre><br />
<h3><a href="http://phpmd.org/">phpmd</a></h3><br />
<p>if文のネスト階層数などの複雑さ、短すぎる、または長すぎる変数名や、使われていない変数の検出など様々な条件に応じて検出を行ってくれます。</p><br />
<pre class="code">$ phpmd /path/to/project text codesize,unusedcode,naming<br />
<br />
/path/to/project/hoge/huga/AAA.php:76   Avoid unused local variables such as '$foo'.<br />
/path/to/project/hoge/huga/AAA.php:129  Avoid unused local variables such as '$bar'.<br />
/path/to/project/hoge/huga/AAA.php:185  Avoid unused local variables such as '$foo'.<br />
/path/to/project/hoge/huga/BBB.class.php:29    Too many fields<br />
/path/to/project/hoge/huga/foo/CCC.php:20 Avoid variables with short names like $a<br />
/path/to/project/hoge/huga/foo/CCC.php:20 Avoid variables with short names like $b<br />
/path/to/project/hoge/huga/foo/EEE.php:5     The method create() has a Cyclomatic Complexity of 12.<br />
/path/to/project/hoge/huga/foo/EEE.php:5     The method create() has an NPath complexity of 288.<br />
/path/to/project/hoge/huga/foo/FFF.php:10     Avoid unused local variables such as '$type'.<br />
/path/to/project/hoge/huga/foo/GGG.php:7    Avoid unused private fields such as '$object'.<br />
/path/to/project/hoge/huga/bar/HHH.php:64  Avoid unused parameters such as '$status'.<br />
/path/to/project/hoge/huga/bar/HHH.php:74  Avoid unused private methods such as 'setStatus'.<br />
/path/to/project/hoge/huga/bar/JJJ.php:26    Avoid unused parameters such as '$status'.<br />
/path/to/project/hoge/huga/bar/KKK.php:3    This class has too many methods, consider refactoring it.<br />
/path/to/project/hoge/huga/bar/KKK.php:13   Avoid unused parameters such as '$status'.<br />
/path/to/project/hoge/huga/bar/LLL.php:44    Avoid unused parameters such as '$status'.</pre><br />
<p>上記はJenkinsのプラグインとして使えるものもありますので、是非検討してみてはいかがでしょうか。</p><br />

