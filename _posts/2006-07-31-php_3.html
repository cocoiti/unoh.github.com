---
layout: post
title: "PHPで可変個の参照渡し"
---
{% raw %}
こんにちは，ttsuruoka です．<br />
<br />
PHP では func_get_args() を使って可変個引数の関数を作ることができます．<br />
<br />
<pre class="source_code"><br />
function execute()<br />
{<br />
    $args = func_get_args()<br />
    ....<br />
}<br />
execute($foo);<br />
execute($foo, $bar);<br />
</pre><br />
<br />
しかしこれには問題があって，参照渡しができません．<br />
<br />
<pre class="source_code"><br />
function execute()<br />
{<br />
    $args = func_get_args();<br />
    $args[0] = 20;<br />
}<br />
$foo = 10;<br />
execute(&$foo);<br />
echo $foo; // 10<br />
</pre><br />
<br />
<br />
func_get_args() が機能しないので，<br />
可変個引数で参照渡しをすることはあきらめて，<br />
array を使って実装します．<br />
<br />
<pre class="source_code"><br />
function execute($a)<br />
{<br />
    // foreach 文では参照が渡せないため for 文<br />
    for ($i = 0; $i < count($a); $i++) {<br />
        $a[$i] = ....<br />
    }<br />
}<br />
execute(array(&$foo, &$bar));<br />
</pre><br />
<br />
<br />
これで可変個を渡すことができますが，<br />
ひとつしか渡さない場合に<br />
<br />
<pre class="source_code"><br />
execute(array(&$foo));<br />
</pre><br />
<br />
と書くのは面倒なので下のようにします．<br />
<br />
<pre class="source_code"><br />
function execute($a)<br />
{<br />
    $t = !is_array($a) ? array(&$a) : $a;<br />
<br />
    for ($i = 0; $i < count($t); $i++) {<br />
        $t[$i] = ....<br />
    }<br />
}<br />
execute(&$foo);<br />
execute(array(&$foo, &$bar));<br />
</pre><br />
<br />
ここで可変個の参照を渡せる関数にこだわるのをやめて，<br />
引数登録用の register メソッドを用意します．<br />
<br />
<pre class="source_code"><br />
class MyClass<br />
{<br />
    var $objs = array();<br />
    <br />
    function register(&$obj)<br />
    {<br />
        $this->objs[] = &$obj;<br />
    }<br />
    <br />
    function execute()<br />
    {<br />
        $n = count($this->objs);<br />
        for ($i = 0; $i < $n; $i++) {<br />
            $this->objs[$i] = ....<br />
        }<br />
    }<br />
}<br />
$c = new MyClass;<br />
$c->register($foo);<br />
$c->register($bar);<br />
$c->execute();<br />
</pre><br />
<br />
めでたしめでたし．<br />
<br />
（注：環境は PHP4）
{% endraw %}
